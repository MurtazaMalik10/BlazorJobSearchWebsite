@page "/joblistings"
@inject NavigationManager NavigationManager

@using Entities
@using DAL

<h3 class="mb-4 text-center">Job Listings</h3>

<div class="row row-cols-1 row-cols-md-2 g-4">
    @if (jobs != null && jobs.Any())
    {
        @foreach (var job in jobs)
        {
            <div class="col mb-4">
                <div class="card">
                    <div class="card-body d-flex">
                        <!-- Thumbnail column -->
                        <div class="thumbnail-column me-4">
                            @if (!string.IsNullOrEmpty(job.Thumbnail))
                            {
                                <img class="thumbnail-img" src="@($"data:image/png;base64,{job.Thumbnail}")" alt="Thumbnail" />
                            }
                        </div>

                        <!-- Job content column -->
                        <div class="job-content">
                            <h5 class="card-title">@job.JobTitle</h5>
                            <h6 class="card-subtitle mb-2 text-muted">Job ID: @job.JobId</h6>
                            <p class="card-text">@job.Description</p>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-primary me-2" @onclick="@(() => ViewJobDetails(job.JobId))">View Job</button>
                                <button class="btn btn-danger" @onclick="@(() => DeleteJob(job.JobId))">Delete Job</button>
                            </div>
                            <!-- Additional job details can be added here -->
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="col">
            <p class="text-center">No jobs found.</p>
        </div>
    }
</div>

<style>
    /* Define the CSS for thumbnail images */
    .thumbnail-img {
        max-width: 100px; /* Adjust the maximum width as needed */
        max-height: 100px; /* Adjust the maximum height as needed */
        object-fit: cover; /* Maintain aspect ratio and cover the area */
        border-radius: 5px; /* Add border-radius for rounded corners */
    }
</style>

@code {
    List<EntJobs> jobs;

    protected override void OnInitialized()
    {
        // Fetch all jobs from the database
        jobs = DALJobs.GetLatestJobsWithThumbnails();
    }

    private void ViewJobDetails(int JobId)
    {
        // Redirect to ViewJob component with jobId in the URL
        NavigationManager.NavigateTo($"/viewjob/{JobId}");
    }

    private void DeleteJob(int JobId)
    {
        DALJobs.DeleteJob(JobId); // Call DAL method to delete job
        jobs = DALJobs.ShowJob(); // Refresh job list after deletion
    }
}
